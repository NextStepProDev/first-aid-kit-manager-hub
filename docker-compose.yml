services:                                                                                                                                     
    postgres:                                                                                                                                   
      image: postgres:17.4                                                                                                                      
      container_name: first-aid-kit-db                                                                                                          
      restart: unless-stopped                                                                                                                   
      environment:                                                                                                                              
        POSTGRES_DB: first_aid_kit                                                                                                              
        POSTGRES_USER: ${POSTGRES_USER}                                                                                                         
        POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}                                                                                                 
      volumes:                                                                                                                                  
        - postgres_data:/var/lib/postgresql/data                                                                                                
      ports:                                                                                                                                    
        - "5432:5432"                                                                                                                           
      healthcheck:                                                                                                                              
        test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d first_aid_kit"]                                                                  
        interval: 5s                                                                                                                            
        timeout: 5s                                                                                                                             
        retries: 5                                                                                                                              
                                                                                                                                                
    api:                                                                                                                                        
      image: ghcr.io/nextstepprodev/first-aid-kit-api:master                                                                                    
      container_name: first-aid-kit-api                                                                                                         
      platform: linux/amd64                                                                                                                     
      restart: always                                                                                                                           
      depends_on:                                                                                                                               
        postgres:                                                                                                                               
          condition: service_healthy                                                                                                            
      ports:                                                                                                                                    
        - "8080:8081"                                                                                                                           
      environment:                                                                                                                              
        SPRING_PROFILES_ACTIVE: docker                                                                                                          
        SERVER_PORT: 8081                                                                                                                       
        SERVER_ADDRESS: 0.0.0.0                                                                                                                 
        SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/first_aid_kit                                                                    
        SPRING_DATASOURCE_USERNAME: ${POSTGRES_USER}                                                                                            
        SPRING_DATASOURCE_PASSWORD: ${POSTGRES_PASSWORD}                                                                                        
        SPRING_MAIL_USERNAME: ${MAIL_USERNAME}                                                                                                  
        SPRING_MAIL_PASSWORD: ${MAIL_PASSWORD}                                                                                                  
        APP_CORS_ALLOWED_ORIGINS:                                                                                                               
  "http://localhost,http://127.0.0.1,https://www.firstaidkit.pl,http://www.firstaidkit.pl,https://firstaidkit.pl,http://firstaidkit.pl"         
        JWT_SECRET: ${JWT_SECRET}                                                                                                               
                                                                                                                                                
    frontend:                                                                                                                                   
      image: ghcr.io/nextstepprodev/first-aid-kit-web:master                                                                                    
      container_name: first-aid-kit-frontend                                                                                                    
      platform: linux/amd64                                                                                                                     
      depends_on:                                                                                                                               
        - api                                                                                                                                   
      expose:                                                                                                                                   
        - "80"                                                                                                                                  
                                                                                                                                                
  volumes:                                                                                                                                      
    postgres_data:                                                                                                                              
      external: false                                                                                                                           
      name: first-aid-kit-persistent-db  
